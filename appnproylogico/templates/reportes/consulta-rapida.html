{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Consulta r치pida</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">
  <style>
    :root{ --primary-color:#2ecc71; --secondary-color:#27ae60 }
    .navbar-custom{ background-color:#212529; padding:0.75rem 0; box-shadow:0 2px 4px rgba(0,0,0,0.1); margin-bottom:2rem }
    .navbar-top-row{ display:flex; justify-content:space-between; align-items:center }
    .navbar-custom .navbar-brand{ color:#fff; font-weight:600; font-size:1.25rem; margin:0; display:flex; align-items:center; gap:.5rem }
    .btn-nav{ background:transparent; border:1px solid rgba(255,255,255,.2); color:#fff; padding:.4rem .8rem; border-radius:6px; display:inline-flex; align-items:center; gap:.5rem; text-decoration:none; font-size:.9rem }
    .btn-nav:hover{ background-color:rgba(255,255,255,.1); border-color:rgba(255,255,255,.3) }
    .btn-success-nav{ background-color:var(--primary-color); border:none; color:#fff; padding:.5rem 1rem; border-radius:6px; display:inline-flex; align-items:center; gap:.5rem; font-weight:500 }
    .btn-success-nav:hover{ background-color:var(--secondary-color) }
    .form-control::placeholder{ color:#fff; opacity:.85 }
  </style>
  <body class="theme-light">
    <nav class="navbar-custom">
      <div class="container-fluid">
        <div class="navbar-top-row">
          <div class="d-flex align-items-center gap-2">
            <a class="btn-nav" href="{% url 'home' %}"><i class="bi bi-house"></i> Volver al inicio</a>
            <span class="navbar-brand"><i class="bi bi-search"></i> Consulta r치pida</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <button id="btn-export" class="btn-success-nav" type="button"><i class="bi bi-download"></i> Exportar CSV</button>
          </div>
        </div>
      </div>
    </nav>
  <div class="container py-4">
    <form class="row g-2 mb-3" method="get">
      <div class="col-md-4"><input class="form-control" type="text" name="local" value="{{ local }}" placeholder="Farmacia"></div>
      <div class="col-md-4"><input class="form-control" type="text" name="motorista" value="{{ motorista }}" placeholder="Motorista"></div>
      <div class="col-md-4"><input class="form-control" type="text" name="cliente" value="{{ cliente }}" placeholder="Cliente"></div>
      <div class="col-12 d-grid"><button class="btn btn-success-nav" type="submit">Buscar</button></div>
    </form>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead><tr><th>C칩digo</th><th>Farmacia</th><th>Motorista</th><th>Cliente</th><th>Estado</th><th>Tipo</th><th>Prioridad</th><th>Registro</th></tr></thead>
        <tbody>
          {% for r in results %}
          <tr>
            <td>{{ r.0 }}</td><td>{{ r.1 }}</td><td>{{ r.2 }}</td><td>{{ r.3 }}</td><td>{{ r.4 }}</td><td>{{ r.5 }}</td><td>{{ r.6 }}</td><td>{{ r.7 }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="8" class="text-center text-muted">Sin resultados</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      const btnExport = document.getElementById('btn-export');
      if (btnExport){
        btnExport.onclick=function(){
          const rows = Array.from(document.querySelectorAll('table tbody tr')).filter(r=>r.style.display!=='none');
          const heads = Array.from(document.querySelectorAll('table thead th')).map(th=>th.textContent.trim());
          const data = rows.map(r=> Array.from(r.children).map(td=> '"'+(td.textContent||'').replace(/"/g,'\"')+'"').join(','));
          const audit = 'Generado: '+new Date().toISOString()+', Vista: Consulta r치pida';
          const csv = [heads.join(','), ...data, audit].join('\n');
          const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href=url; a.download='consulta_rapida.csv'; a.click(); URL.revokeObjectURL(url);
        };
      }
    })();
  </script>
</body>
</html>
